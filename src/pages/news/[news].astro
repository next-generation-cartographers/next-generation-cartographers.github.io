---
import { getCollection, render } from "astro:content";
import NewsList from "../../components/NewsList.astro";
import Layout from "../../layouts/Layout.astro";
import formatDate from "../../lib/formatDate";

export async function getStaticPaths() {
  const newsCollection = await getCollection("news");
  return newsCollection.map((news) => ({
    params: { news: news.id.replace("news/", "") },
    props: { news },
  }));
}

const { news } = Astro.props;
const { Content } = await render(news);
const newsCollection = await getCollection("news");
---

<Layout>
  <article>
    <header>
      <h2 id={news.id}>{news.data.title}</h2>
      <time class="monospace" datetime={news.data.date.toISOString()}
        >{formatDate(news.data.date.toISOString())}</time
      >
    </header>

    <Content />
  </article>

  <h3 class="more-news">More news</h3>
  <div class="feature">
    <NewsList
      newsEntries={newsCollection
        .toSorted((a, b) => {
          const aDate = new Date(a.data.date);
          const bDate = new Date(b.data.date);
          return bDate.getTime() - aDate.getTime();
        })
        .slice(0, 3)}
      showSummary={false}
    />
  </div>

  <style>
    header {
      margin-bottom: var(--spacing-lg);
    }
  </style>
</Layout>
