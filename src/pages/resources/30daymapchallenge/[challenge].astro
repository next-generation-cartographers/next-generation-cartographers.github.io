---
import { getCollection, render } from "astro:content";
import Layout from "../../../layouts/Layout.astro";
import { Image } from "astro:assets";

export async function getStaticPaths() {
  const challenges = await getCollection("thirtyDayMapChallenges");
  return challenges.map((challenge) => ({
    params: { challenge: challenge.id.split("/").at(0) },
    props: { challenge },
  }));
}

const { challenge } = Astro.props;
const { Content } = await render(challenge);
---

<Layout>
  <Content />
  <div class="maps-gallery">
    {
      challenge.data.maps.map((d) => (
        <div class="map-item">
          <a href={d.linkedInUrl} target="_blank" rel="noopener noreferrer">
            <p class="map-title">
              Day {d.day}, {d.topic} by {d.author}
            </p>
            <Image
              src={d.image}
              width={250}
              height={250}
              densities={[1, 2]}
              alt={`Map for day ${d.day}: ${d.topic} by ${d.author}`}
            />
          </a>
        </div>
      ))
    }
  </div>

  <style>
    .maps-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--spacing-xs);
      justify-items: stretch;

      margin-top: var(--spacing);
    }

    .map-item {
      position: relative;
      overflow: hidden;
      aspect-ratio: 1/1;
    }

    .map-item img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      object-position: top;
    }

    .map-item .map-title {
      position: absolute;
      left: 0;
      right: 0;
      bottom: 0;
      font-size: 80%;
      background: linear-gradient(
        to top,
        color-mix(in srgb, var(--background) 95%, transparent 5%) 50%,
        color-mix(in srgb, var(--background) 85%, transparent 5%) 60%,
        transparent 100%
      );
      padding: 8px;
      padding-top: 20px;
      margin: 0;
      height: fit-content;
    }
  </style>
</Layout>
